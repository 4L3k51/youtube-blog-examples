```markdown
# Building an Automated AI-Powered Social Media Content Workflow with NAN and Supabase

Looking to streamline your social media content generation using AI? This guide walks through creating a fully automated workflow that generates engaging Twitter content about PostgreSQL, pairs it with a code snippet image, and stores everything in Supabase—all orchestrated by [NAN](https://nan.ai/) and OpenAI.

## Overview

The goal is to set up a workflow that, once a day, uses AI to generate a Twitter post and a supporting image. The text and image prompt are generated by OpenAI, the image is AI-created, then uploaded to Supabase Storage. Finally, the tweet content and image URL are stored in a Supabase database table for later use.

## Prerequisites

Before you begin, ensure you have:
- A [Supabase](https://supabase.com/) account and project (with Storage and Database configured)
- [NAN](https://nan.ai/) account with access to the workflow automation feature
- OpenAI API access for both text and image generation
- Optional: Access keys for creating and managing your Supabase Storage S3 bucket

---

## Step 1: Plan the Workflow

Here’s the workflow we’ll automate:
1. **Trigger:** Runs daily.
2. **OpenAI (Text):** Generates a helpful PostgreSQL-themed tweet and an image prompt.
3. **OpenAI (Image):** Uses the prompt to generate a code snippet image.
4. **Upload to Supabase Storage (S3-compatible):** Stores the generated image.
5. **Insert into Supabase Database:** Saves the tweet text, image prompt, and image URL.

> **Note:** Supabase Storage is S3-compatible, so generic S3 upload actions work even if NAN lacks a native Supabase Storage action.

---

## Step 2: Generate a NAN Workflow in JSON (Optional)

Rather than building the workflow manually, you can ask an AI agent (like ChatGPT, Gemini) to generate a NAN-compatible JSON workflow definition based on your description.

**Example prompt for the AI agent:**
```
Create a NAN automation workflow JSON that:
- Runs daily
- Uses OpenAI to generate a Twitter post about Postgres and a code snippet image prompt
- Generates the image using OpenAI API
- Uploads the image to Supabase Storage via S3 upload
- Inserts tweet text, image prompt, image URL into Supabase DB
Also provide the SQL to create the necessary Supabase table.
```
Copy the resulting JSON workflow into your NAN workspace to scaffold your automation.

---

## Step 3: Create Required Supabase Database Table

Use the provided SQL (or the AI agent’s) to set up your table for storing social media content.

```sql
CREATE TABLE social_media_posts (
    id BIGSERIAL PRIMARY KEY,
    tweet_text TEXT,
    image_prompt TEXT,
    image_url TEXT,
    tip_category TEXT,
    code_snippet TEXT,
    status TEXT DEFAULT 'pending',
    published_at TIMESTAMPTZ,
    updated_at TIMESTAMPTZ DEFAULT now()
);
```

> **Important:** Enable [Row-Level Security (RLS)](https://supabase.com/docs/guides/auth/row-level-security) on your new table to prevent unauthorized access.

---

## Step 4: Set Up Supabase Storage

1. Go to **Storage** in your Supabase project and create a new bucket.
   - Make it public if you’re only storing non-sensitive images.
   - Example bucket name: `social_media_images`

2. Obtain your S3 credentials:
   - **Endpoint:** Copy the Supabase Storage endpoint URL.
   - **Region:** Use the region of your Supabase project (or a placeholder if not needed).
   - **Access Key ID / Secret:** Generate these under Storage > Configuration > Create Access Key.
   
   > **Warning:** Keep your Secret Access Key private! Anyone with it can read/write your storage bucket.

---

## Step 5: Build and Configure the NAN Workflow

### 1. **Trigger: Set to Daily**
   - Use the standard NAN trigger to run the workflow every 24 hours.

### 2. **OpenAI Step (Text Generation)**
   - Model: GPT-4 or latest available.
   - System Prompt Example:
     ```
     You are a Postgres expert and social media content creator. Generate an engaging Twitter tip about Postgres and provide a matching image prompt for a code snippet. Respond with JSON only.
     ```
   - Ensure that "Output as JSON" is enabled.

   Example output structure:
   ```json
   {
     "tweet_text": "Speed up slow COUNT(*) queries in Postgres by using indexed columns.",
     "image_prompt": "Clean code snippet demonstrating efficient Postgres COUNT usage.",
     "tip_category": "performance",
     "code_snippet": "SELECT COUNT(*) FROM users WHERE active = true;"
   }
   ```

### 3. **OpenAI Image Generation**
   - Use the `image_prompt` from the previous step.
   - Adjust image size/resolution to your needs.
   - Model: GPT image generation (e.g., DALL-E or equivalent).

### 4. **Prepare the Image Filename**
   - Add a data transformation step to create a unique filename for the image:
     - Example: current timestamp + ".png"
     - Output: e.g., `social_tip_20240602_120000.png`

### 5. **Upload to Supabase Storage (S3-compatible)**
   - Use the S3 upload action in NAN.
   - Enter S3 endpoint, region, Access Key ID, Secret Access Key, and bucket name.
   - Set the filename from previous step.
   - **Force Path Style:** *Enable this setting. The upload won’t work otherwise!*
   
   > **Tip:** Skip the "prepare upload" step; just pass the generated file as-is.

### 6. **Construct Image URL**
   The image URL in Supabase typically follows this pattern:
   ```
   https://<project-ref>.supabase.co/storage/v1/object/public/<bucket-name>/<filename>
   ```
   - Combine your Supabase project ref, bucket, and filename to generate the image URL.

### 7. **Insert Data into Supabase Database**
   - Set up Supabase credentials (database URL, Service Role Key).
   - Insert values for:
     - `tweet_text`
     - `image_prompt`
     - `image_url`
     - `tip_category`
     - `code_snippet`
     - (optionally) `status`, `published_at`

---

## Sample NAN Workflow JSON Snippet

> This is a conceptual example. Replace placeholders as required.

```json
{
  "trigger": { "type": "every_day", "interval": 24 },
  "steps": [
    {
      "type": "openai_text",
      "model": "gpt-4",
      "prompt": "You are a Postgres expert and social media content creator..."
    },
    {
      "type": "openai_image",
      "prompt": "{{steps.0.result.image_prompt}}"
    },
    {
      "type": "transform",
      "filename": "social_tip_{{now}}.png"
    },
    {
      "type": "s3_upload",
      "endpoint": "https://<project-ref>.supabase.co/storage/v1/s3",
      "bucket": "social_media_images",
      "access_key_id": "<your-key-id>",
      "secret_access_key": "<your-secret>",
      "filename": "{{steps.2.result.filename}}",
      "body": "{{steps.1.result.image_binary}}",
      "force_path_style": true
    },
    {
      "type": "supabase_insert",
      "table": "social_media_posts",
      "fields": {
        "tweet_text": "{{steps.0.result.tweet_text}}",
        "image_prompt": "{{steps.0.result.image_prompt}}",
        "image_url": "https://<project-ref>.supabase.co/storage/v1/object/public/social_media_images/{{steps.2.result.filename}}",
        "tip_category": "{{steps.0.result.tip_category}}",
        "code_snippet": "{{steps.0.result.code_snippet}}"
      },
      "credentials": {
        "url": "https://<project-ref>.supabase.co",
        "service_role": "<your-service-role-key>"
      }
    }
  ]
}
```

---

## Final Tips and Next Steps

- **Expand the Workflow:** Consider adding steps for human review, auto-scheduling posts, or even multi-platform posting.
- **Security & RLS:** Always enable Row-Level Security on your Supabase tables.
- **Monitor for Success/Failures:** NAN’s logs can help debug or monitor workflow executions.
- **Automation Flexibility:** Use other AIs or adjust prompts as your use case evolves.
- **Cleanup:** Schedule removal of old images or posts if needed.

---

## Conclusion

With this setup, you’ve automated the creation, storage, and cataloging of AI-generated social media content using NAN, OpenAI, and Supabase. This foundation can be expanded in countless ways—from approving content before publishing, adding analytics, to posting directly on social platforms. Whether you’re running marketing at scale or just want to save time, this combination gives you a robust, flexible base for automated content workflows.

Happy building—and let me know what awesome ideas you launch with NAN and Supabase!

```